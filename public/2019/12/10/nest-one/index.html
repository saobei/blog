<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Nest.js项目入门实战(一)"><meta name="keywords" content="Nest.js,入门实战"><meta name="author" content="扫呗"><meta name="copyright" content="扫呗"><title>Nest.js项目入门实战(一) | 扫呗无线前端团队</title><link rel="shortcut icon" href="/blog/melody-favicon.ico"><link rel="stylesheet" href="/blog/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/blog/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#内容概要"><span class="toc-number">1.</span> <span class="toc-text">内容概要</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nest-js简介"><span class="toc-number">2.</span> <span class="toc-text">Nest.js简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用Nest-CLI创建项目"><span class="toc-number">3.</span> <span class="toc-text">使用Nest CLI创建项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nest项目-基础知识"><span class="toc-number">4.</span> <span class="toc-text">Nest项目-基础知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nest项目-连接数据库"><span class="toc-number">5.</span> <span class="toc-text">Nest项目-连接数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nest项目-创建一个PhotoModule"><span class="toc-number">6.</span> <span class="toc-text">Nest项目-创建一个PhotoModule</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nest项目-PhotoController和PhotoService"><span class="toc-number">7.</span> <span class="toc-text">Nest项目-PhotoController和PhotoService</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PhotoService中处理数据"><span class="toc-number">8.</span> <span class="toc-text">PhotoService中处理数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#未完待续"><span class="toc-number">9.</span> <span class="toc-text">未完待续..</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://img.lcsw.cn/blog_avatar.jpg"></div><div class="author-info__name text-center">扫呗</div><div class="author-info__description text-center">让支付回归简单</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/blog/archives"><span class="pull-left">Articles</span><span class="pull-right">12</span></a><a class="author-info-articles__tags article-meta" href="/blog/tags"><span class="pull-left">Tags</span><span class="pull-right">12</span></a><a class="author-info-articles__categories article-meta" href="/blog/categories"><span class="pull-left">Categories</span><span class="pull-right">5</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接</div><a class="author-info-links__name text-center" href="http://www.lcsw.cn">扫呗官网</a><a class="author-info-links__name text-center" href="https://75team.com/post/list">奇舞团博客</a><a class="author-info-links__name text-center" href="https://www.liaoxuefeng.com/">廖雪峰博客</a><a class="author-info-links__name text-center" href="https://fed.taobao.org/">淘宝FED</a><a class="author-info-links__name text-center" href="https://www.cnblogs.com/TomXu/archive/2011/12/15/2288411.html">汤姆大叔的博客</a><a class="author-info-links__name text-center" href="http://eux.baidu.com/">百度EUX</a><a class="author-info-links__name text-center" href="https://coolshell.cn/">酷壳</a><a class="author-info-links__name text-center" href="https://aotu.io/notes/">凹凸实验室</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://img.lcsw.cn/blog_banner.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/blog/">扫呗无线前端团队</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/blog/">首页</a><a class="site-page" href="/blog/categories/vue">Vue</a><a class="site-page" href="/blog/categories/nestjs">NestJs</a><a class="site-page" href="/blog/categories/angular">Angular</a><a class="site-page" href="/blog/categories/typescript">Typescript</a><a class="site-page" href="/blog/categories/小程序">小程序</a><a class="site-page" href="/blog/categories/源码解读">源码解读</a><a class="site-page" href="/blog/categories/项目总结">项目总结</a></span></div><div id="post-info"><div id="post-title">Nest.js项目入门实战(一)</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-10</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/blog/categories/nestjs/">nestjs</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h3 id="内容概要"><a href="#内容概要" class="headerlink" title="内容概要"></a>内容概要</h3><ul>
<li>该篇主要介绍Nest.js项目的基础知识以及项目初始搭建,nest cli的使用,以及连接数据库实现一个简单的增删改查接口的项目示例</li>
</ul>
<h3 id="Nest-js简介"><a href="#Nest-js简介" class="headerlink" title="Nest.js简介"></a>Nest.js简介</h3><p>Nest是一套现代化的基于Node.js的强大的Web应用框架</p>
<p>Nest的核心概念是提供一种体系结构，它帮助开发人员实现层的最大分离，并在应用程序中增加抽象</p>
<blockquote>
<p>文档：<a href="https://nestjs.com/" target="_blank" rel="noopener">https://nestjs.com/</a><br>中文文档：<a href="https://docs.nestjs.cn/" target="_blank" rel="noopener">https://docs.nestjs.cn/</a><br>git地址：<a href="https://github.com/nestjs/nest" target="_blank" rel="noopener">https://github.com/nestjs/nest</a></p>
</blockquote>
<hr>
<h3 id="使用Nest-CLI创建项目"><a href="#使用Nest-CLI创建项目" class="headerlink" title="使用Nest CLI创建项目"></a>使用Nest CLI创建项目</h3><p>安装CLI &nbsp;&nbsp;&nbsp; <code>npm i -g @nestjs/cli</code><br>使用CLI新建项目 &nbsp;&nbsp;&nbsp; <code>nest new project-name</code></p>
<p>运行后会默认创建以下内容</p>
<pre><code>CREATE /nest-test-peoject/.prettierrc (51 bytes)
CREATE /nest-test-peoject/nest-cli.json (64 bytes)
CREATE /nest-test-peoject/package.json (1700 bytes)
CREATE /nest-test-peoject/README.md (3370 bytes)
CREATE /nest-test-peoject/tsconfig.build.json (97 bytes)
CREATE /nest-test-peoject/tsconfig.json (336 bytes)
CREATE /nest-test-peoject/tslint.json (426 bytes)
CREATE /nest-test-peoject/src/app.controller.spec.ts (617 bytes)
CREATE /nest-test-peoject/src/app.controller.ts (274 bytes)
CREATE /nest-test-peoject/src/app.module.ts (249 bytes)
CREATE /nest-test-peoject/src/app.service.ts (142 bytes)
CREATE /nest-test-peoject/src/main.ts (208 bytes)
CREATE /nest-test-peoject/test/app.e2e-spec.ts (561 bytes)
CREATE /nest-test-peoject/test/jest-e2e.json (183 bytes)</code></pre><p>这里为我们创建了一个根模块AppModule &nbsp;&nbsp;&nbsp; <code>main.ts</code>为项目启动入口文件</p>
<h3 id="Nest项目-基础知识"><a href="#Nest项目-基础知识" class="headerlink" title="Nest项目-基础知识"></a>Nest项目-基础知识</h3><ul>
<li><p>模块Module<br>  用于将代码拆分为独立的和可重用的模块，例如有一个用户信息模块，然后将该用户模块的控制器和服务集合进来，最后需要将用户模块导入到根Module使用。<br>每个Nest应用都有一个根模块，通常是 AppModule。根模块提供了用来启动应用的引导机制，可以包含很多功能模块。</p>
<br>

<p>  <strong>Module模块中@Module()装饰器接受一个对象</strong></p>
<table>
<thead>
<tr>
<th>属性</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td>providers</td>
<td align="center">由nest注入器实例化的服务，可以在这个模块之间共享</td>
</tr>
<tr>
<td>controller</td>
<td align="center">存放创建的一组控制器</td>
</tr>
<tr>
<td>imports</td>
<td align="center">导入此模块中所需的提供程序的模块列表</td>
</tr>
<tr>
<td>exports</td>
<td align="center">导出这个模块可以其他模块享用providers里的服务</td>
</tr>
</tbody></table>
</li>
<li><p>控制器Controller<br>  通俗来说就是路由Router，负责处理客户端传入的请求参数并向客户端返回响应数据，也可以理解是HTTP请求。nest.js提供许多http请求的装饰器，例如:方法参数装饰器@Param,@Body(),@Query;方法装饰器@Post(),@Get,@Put()等。</p>
</li>
<li><p>服务与依赖注入 Provider &amp; Dependency injection<br>  在这里处理所有请求执行逻辑，在控制器中通过constructor函数以依赖注入的方式实现。Controller负责处理Request及产生Response，而数据库存取或是业务逻辑通常写在Service class里。<br>  提供程序是 Nest的一个基本概念。许多基本的 Nest类可能被视为提供者 - service,repository, factory 等等。 他们都可以通过 constructor 注入依赖关系。 这意味着对象可以彼此创建各种关系，并且“连接”对象实例的功能在很大程度上可以委托给 Nest运行时系统。 提供者只是一个用 @Injectable()装饰器注释的类。</p>
</li>
<li><p>Middleware 中间件<br>  中间件是在路由处理程序之前调用的函数。中间件功能可以访问请求和响应对象，以及应用程序请求-响应周期中的下一个中间件功能。<br>  中间件函数可以执行以下任务:</p>
<ul>
<li>执行任何代码。</li>
<li>对请求和响应对象进行更改。</li>
<li>结束请求-响应周期。</li>
<li>调用堆栈中的下一个中间件函数。</li>
<li>如果当前的中间件函数没有结束请求-响应周期, 它必须调用 next() 将控制传递给下一个中间件函数。否则, 请求将被挂起。</li>
</ul>
</li>
<li><p>Exception filter 过滤器<br>  Nest 内置了全局异常处理层，一旦应用程序抛出异常，Nest 便会自动捕获这些异常并给出 JSON 形式的响应。<br>  未知类型的错误将会抛出以下错误</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;statusCode&quot;: 500,</span><br><span class="line">	&quot;message&quot;: &quot;Internal server error&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Pipe 管道<br>  管道是具有 @Injectable() 装饰器的类。管道应实现 PipeTransform 接口。<br>  管道有两个类型:<br>  转换：管道将输入数据转换为所需的数据输出<br>  验证：对输入数据进行验证，如果验证成功继续传递; 验证失败则抛出异常;</p>
</li>
<li><p>Guard 守卫<br>  守卫可以做权限认证，如果你没有权限可以拒绝你访问这个路由，默认返回403错误<br>  守卫是用@Injectable()装饰器注释的类。应该实现CanActivate接口，具体代码在canActivate方法实现，返回一个布尔值，true就表示有权限，false抛出异常403错误。<br>  使用：<br>  直接@UseGuards()装饰器里面使用，作用当前控制器路由所有的请求参数 从 @nestjs/common 包导入。<br>  在全局注册使用内置实例方法useGlobalGuards，作用整个项目。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const app = await NestFactory.create(AppModule);</span><br><span class="line">app.useGlobalGuards(new Guard());</span><br></pre></td></tr></table></figure>
</li>
<li><p>Interceptor 拦截器<br>  拦截器可以做很多功能，比如缓存处理，响应数据转换，异常捕获转换，响应超时跑错，打印请求响应日志。<br>  设置拦截器：为了设置拦截器, 我们使用从 @nestjs/common 包导入的 @UseInterceptors() 装饰器。与守卫一样, 拦截器可以是控制器范围内的, 方法范围内的或者全局范围内的。</p>
</li>
</ul>
<p><font color="red"> 以上内容nestjs文档都有详细描述具体可以<a href="https://docs.nestjs.cn/" target="_blank" rel="noopener">前往阅读</a></font></p>
<h3 id="Nest项目-连接数据库"><a href="#Nest项目-连接数据库" class="headerlink" title="Nest项目-连接数据库"></a>Nest项目-连接数据库</h3><ul>
<li>Nest 与数据库无关，可以轻松地与任何 SQL 或 NoSQL 数据库集成。我们可以直接使用任何通用的 Node.js 数据库集成库或 ORM ，例如 <a href="https://sequelize.org/" target="_blank" rel="noopener">Sequelize (recipe)</a>,<a href="https://typeorm.io/#/" target="_blank" rel="noopener">TypeORM</a> ，以在更高的抽象级别上进行操作。Nest 使用TypeORM是因为它是 TypeScript 中最成熟的对象关系映射器( ORM )。因为它是用 TypeScript 编写的，所以可以很好地与 Nest 框架集成。这里我们连接操作mysql数据库。<br>安装typeorm 和 mysql  <code>npm install --save @nestjs/typeorm typeorm mysql</code><br>将<code>TypeOrmModule</code>导入<code>AppModule</code>。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TypeOrmModule &#125; <span class="keyword">from</span> <span class="string">'@nestjs/typeorm'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">imports: [</span><br><span class="line">	TypeOrmModule.forRoot(&#123;</span><br><span class="line">	<span class="keyword">type</span>: <span class="string">'mysql'</span>, <span class="comment">// 数据库类型。你必须指定要使用的数据库引擎。该值可以是"mysql"，"postgres"，"mariadb"，"sqlite"，"cordova"，"nativescript"，"oracle"，"mssql"，"mongodb"，"sqljs"，"react-native"。此选项是必需的。</span></span><br><span class="line">	name:<span class="string">''</span>, <span class="comment">// 连接名。 在使用 getConnection(name: string) 或 ConnectionManager.get(name: string)时候需要用到。不同连接的连接名称不能相同，它们都必须是唯一的。如果没有给出连接名称，那么它将被设置为"default"。</span></span><br><span class="line">	host: <span class="string">'localhost'</span>, <span class="comment">// 数据库 host</span></span><br><span class="line">	port: <span class="number">3306</span>, <span class="comment">// 数据库端口。mysql 默认的端口是3306.</span></span><br><span class="line">	username: <span class="string">'root'</span>, <span class="comment">// 数据库用户名</span></span><br><span class="line">	password: <span class="string">'root'</span>, <span class="comment">// 数据库密码</span></span><br><span class="line">	database: <span class="string">'test'</span>, <span class="comment">// 数据库名</span></span><br><span class="line">	entities: [],<span class="comment">//  要加载并用于此连接的实体。接受要加载的实体类和目录路径。目录支持 glob 模式。示例：entities: [ "entity/*.js", "modules/**/entity/*.js"]。</span></span><br><span class="line">	synchronize: <span class="literal">true</span>,<span class="comment">// 指示是否在每次应用程序启动时自动创建数据库架构。 请注意此选项，不要在生产环境中使用它，否则将丢失所有生产数据。但是此选项在调试和开发期间非常有用。</span></span><br><span class="line">	charset:<span class="string">'utf8mb4'</span>, <span class="comment">// 连接的字符集</span></span><br><span class="line">	timezone: <span class="string">'+0800'</span>, <span class="comment">// MySQL 服务器上配置的时区。这用于将服务器日期/时间值强制转换为 JavaScript Date 对象</span></span><br><span class="line">	logging: <span class="literal">true</span>, <span class="comment">// 指示是否启用日志记录。如果设置为true，则将启用查询和错误日志记录。</span></span><br><span class="line">	connectTimeout:<span class="string">'10000'</span>, <span class="comment">// 在连接到 MySQL 服务器期间发生超时之前的毫秒数。 （默认值：10000）</span></span><br><span class="line">	...</span><br><span class="line">	&#125;),</span><br><span class="line">],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppModule &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>forRoot() 方法接受与来自 TypeORM包的 createConnection() 相同的配置对象。另外，我们可以创建 ormconfig.json ，而不是将配置对象传递给 forRoot()。<br>一旦完成，TypeORM 连接和 EntityManager 对象就可以在整个项目中注入(不需要导入任何模块)</p>
<ul>
<li>存储库模式<br>  TypeORM 支持存储库设计模式，因此每个实体都有自己的存储库。可以从数据库连接获得这些存储库。<br>  需要使用官方TypeORM文档中的  entity 实体</li>
</ul>
<h3 id="Nest项目-创建一个PhotoModule"><a href="#Nest项目-创建一个PhotoModule" class="headerlink" title="Nest项目-创建一个PhotoModule"></a>Nest项目-创建一个PhotoModule</h3><p>上面已经在AppModule注入了TypeOrmModule并配置数据库信息，现在我们配置TypeOrmModule.forRoot()中的entities为(glob 模式匹配目录文件)</p>
<pre><code>entities:[__dirname + &apos;/**/*.entity{.ts,.js}&apos;]</code></pre><p>方便我们在文件中创建entity文件，其中<code>__dirname</code> 表示的是当前文件所在目录  <code>**</code>匹配任意数量的字符包括空字符和路径分隔符 <code>*</code>匹配任意数量的字符包括空字符<br>接下来使用<code>nest g mo photo</code>创建PhotoModule，该命令将在src目录下创建了photo文件目录并新建了PhotoModule文件自动注入到了AppModule</p>
<pre><code>nest g mo photo
CREATE /src/photo/photo.module.ts (82 bytes)
UPDATE /src/app.module.ts (1359 bytes)</code></pre><p>创建完成后AppModule如下</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AppController &#125; <span class="keyword">from</span> <span class="string">'./app.controller'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AppService &#125; <span class="keyword">from</span> <span class="string">'./app.service'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Connection &#125; <span class="keyword">from</span> <span class="string">'typeorm'</span>;	</span><br><span class="line"><span class="keyword">import</span> &#123; TypeOrmModule &#125; <span class="keyword">from</span> <span class="string">'@nestjs/typeorm'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; PhotoModule &#125; <span class="keyword">from</span> <span class="string">'./photo/photo.module'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  imports: [</span><br><span class="line">    TypeOrmModule.forRoot(&#123;</span><br><span class="line">        <span class="keyword">type</span>: <span class="string">'mysql'</span>,</span><br><span class="line">        host: <span class="string">'192.168.1.6'</span>,</span><br><span class="line">        port: <span class="number">3306</span>,</span><br><span class="line">        username: <span class="string">'root'</span>,</span><br><span class="line">        password: <span class="string">'xxxx'</span>,</span><br><span class="line">        database: <span class="string">'xxxx'</span>,</span><br><span class="line">        entities: [__dirname + <span class="string">'/**/*.entity&#123;.ts,.js&#125;'</span>],</span><br><span class="line">        synchronize: <span class="literal">true</span>,</span><br><span class="line">        timezone: <span class="string">'+0800'</span>,</span><br><span class="line">        logging: <span class="literal">true</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    PhotoModule,</span><br><span class="line">  ],</span><br><span class="line">  controllers: [AppController],</span><br><span class="line">  providers: [</span><br><span class="line">      AppService</span><br><span class="line">    ],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppModule &#123;</span><br><span class="line">	<span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> readonly connection: Connection</span>) &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来我们依次创建PhotoController和PhotoService</p>
<pre><code>nest g co photo
CREATE /src/photo/photo.controller.spec.ts (486 bytes)
CREATE /src/photo/photo.controller.ts (99 bytes)
UPDATE /src/photo/photo.module.ts (170 bytes)

nest g s photo
CREATE /src/photo/photo.service.spec.ts (453 bytes)
CREATE /src/photo/photo.service.ts (89 bytes)
UPDATE /src/photo/photo.module.ts (247 bytes)</code></pre><p>一般的我们将entity文件放在他们的域中, 放在相应的模块目录中。当然也可以在src目录下新建entities目录将entity文件放在该目录下管理。</p>
<ul>
<li>创建photo实体(photo.entity.ts)<br>实体是一个映射到数据库表（或使用 MongoDB 时的集合）的类。 你可以通过定义一个新类来创建一个实体，并用@Entity()来标记：<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Entity, Column, PrimaryGeneratedColumn &#125; <span class="keyword">from</span> <span class="string">'typeorm'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span>(<span class="string">'photo'</span>) <span class="comment">// 实体名称 对应数据库表名</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> Photo &#123;</span><br><span class="line"><span class="meta">@PrimaryGeneratedColumn</span>(&#123;comment: <span class="string">'照片表'</span>&#125;)</span><br><span class="line">id: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Column</span>(&#123; nullable: <span class="literal">true</span>, length: <span class="number">30</span>, comment: <span class="string">'照片名称'</span> &#125;)</span><br><span class="line">name: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Column</span>(&#123; nullable: <span class="literal">false</span>, <span class="keyword">default</span>:<span class="number">0</span>, comment: <span class="string">'该条记录状态 0正常 1删除'</span> &#125;)</span><br><span class="line">status: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Column</span>(&#123; nullable: <span class="literal">true</span>, <span class="keyword">type</span>: <span class="string">'datetime'</span>, comment: <span class="string">'该条记录创建时间'</span> &#125;)</span><br><span class="line">create_time: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Column</span>(&#123; nullable: <span class="literal">true</span>, length: <span class="number">255</span>, comment: <span class="string">'照片资源链接'</span> &#125;)</span><br><span class="line">url: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// orm配置中若synchronize为true则会在数据库自动执行创建表sql 创建photo表</span></span><br><span class="line">CREATE TABLE <span class="string">`photo`</span> (</span><br><span class="line">	<span class="string">`id`</span> int(<span class="number">11</span>) NOT NULL AUTO_INCREMENT COMMENT <span class="string">'照片表'</span>,</span><br><span class="line">	<span class="string">`name`</span> varchar(<span class="number">30</span>) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT <span class="string">'照片名称'</span>,</span><br><span class="line">	<span class="string">`status`</span> int(<span class="number">11</span>) NOT NULL DEFAULT <span class="string">'0'</span> COMMENT <span class="string">'该条记录状态 0正常 1删除'</span>,</span><br><span class="line">	<span class="string">`create_time`</span> datetime DEFAULT NULL COMMENT <span class="string">'该条记录创建时间'</span>,</span><br><span class="line">	<span class="string">`url`</span> varchar(<span class="number">255</span>) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT <span class="string">'照片资源链接'</span>,</span><br><span class="line">	PRIMARY KEY (<span class="string">`id`</span>)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><font color="red"> synchronize: true,指示是否在每次应用程序启动时自动创建数据库架构。<br>请注意此选项，不要在生产环境中使用它，否则将丢失所有生产数据。但是此选项在调试和开发期间非常有用。</font></p>
<p><a href="https://typeorm.io/#/entities" target="_blank" rel="noopener">实体列属性等相关配置具体可参考typeOrm中实体</a></p>
<h3 id="Nest项目-PhotoController和PhotoService"><a href="#Nest项目-PhotoController和PhotoService" class="headerlink" title="Nest项目-PhotoController和PhotoService"></a>Nest项目-PhotoController和PhotoService</h3><p>接下来我们在PhotoController中创建几个方法用来接收客户端传入的请求参数并向客户端返回响应数据</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Controller, Get, Post, Patch, Body, Query &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; PhotoService &#125; <span class="keyword">from</span> <span class="string">'./photo.service'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">'photo'</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> PhotoController &#123;</span><br><span class="line">    <span class="comment">// 宣告变量，型別为PhotoService</span></span><br><span class="line">    <span class="comment">// private readonly photoService:PhotoService;</span></span><br><span class="line">    <span class="comment">// 建立PhotoController实例，一并建立PhotoService实例</span></span><br><span class="line">    <span class="comment">// constructor() &#123; this.photoService= new PhotoService(); &#125; </span></span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> readonly photoService: PhotoService</span>) &#123; &#125; <span class="comment">// 将PhotoService注入到PhotoController</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建相片记录</span></span><br><span class="line"><span class="comment">     * @param body</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Post</span>() <span class="comment">// 请求方法装饰器</span></span><br><span class="line">    <span class="keyword">async</span> createPhoto(<span class="meta">@Body</span>() body): <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> <span class="keyword">this</span>.photoService.createPhoto(body);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除相片记录</span></span><br><span class="line"><span class="comment">     * @param body</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Patch</span>()</span><br><span class="line">    <span class="keyword">async</span> deletePhoto(<span class="meta">@Body</span>() body): <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> <span class="keyword">this</span>.photoService.deletePhoto(body);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 编辑相片记录内容</span></span><br><span class="line"><span class="comment">     * @param body</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Patch</span>()</span><br><span class="line">    <span class="keyword">async</span> updatePhoto(<span class="meta">@Body</span>() body): <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> <span class="keyword">this</span>.photoService.updatePhoto(body);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取相片列表</span></span><br><span class="line"><span class="comment">     * @param query</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Get</span>()</span><br><span class="line">    <span class="keyword">async</span> getPhotos(<span class="meta">@Query</span>() query): <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> <span class="keyword">this</span>.photoService.getPhotos(query);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应的 我们需要在PhotoService中写上对应的方法处理所有请求执行逻辑</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Injectable &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Photo &#125; <span class="keyword">from</span> <span class="string">'../entities/photo.entity'</span>; <span class="comment">// 引入实体文件</span></span><br><span class="line"><span class="keyword">import</span> &#123; InjectRepository &#125; <span class="keyword">from</span> <span class="string">'@nestjs/typeorm'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Repository, getRepository &#125; <span class="keyword">from</span> <span class="string">'typeorm'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> PhotoService &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">        <span class="meta">@InjectRepository</span>(Photo)</span></span><br><span class="line"><span class="params">        <span class="keyword">private</span> readonly photoRepository: Repository&lt;Photo&gt;, <span class="comment">// Photo存储库</span></span></span><br><span class="line"><span class="params">    </span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建相片记录</span></span><br><span class="line"><span class="comment">     * @param body</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> createPhoto(body): <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> newPhoto = <span class="keyword">new</span> Photo();</span><br><span class="line">        newPhoto.create_time = body.create_time;</span><br><span class="line">        newPhoto.name = body.name;</span><br><span class="line">        <span class="comment">// newPhoto.status = body.status;</span></span><br><span class="line">        newPhoto.url = body.url;</span><br><span class="line">        <span class="keyword">const</span> newOrderRes = <span class="keyword">await</span> <span class="keyword">this</span>.photoRepository.save(newPhoto);</span><br><span class="line">        <span class="keyword">return</span> &#123; message: <span class="string">'创建成功'</span>, code: <span class="string">'01'</span>, content: newOrderRes &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除相片记录</span></span><br><span class="line"><span class="comment">     * @param body</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> deletePhoto(body): <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">        <span class="comment">// await this.photoRepository.delete(body.id);</span></span><br><span class="line">        <span class="comment">// await this.photoRepository.delete( &#123; name:body.name&#125;);</span></span><br><span class="line">        <span class="keyword">const</span> needDelete = <span class="keyword">await</span> <span class="keyword">this</span>.photoRepository.findOne(body.id);</span><br><span class="line">        <span class="keyword">await</span> getRepository(Photo)</span><br><span class="line">            .createQueryBuilder(<span class="string">'Photo'</span>)</span><br><span class="line">            .update(needDelete)</span><br><span class="line">            .where(<span class="string">'id = :id'</span>, &#123; id: body.id &#125;)</span><br><span class="line">            .set(&#123; status: <span class="number">1</span> &#125;)</span><br><span class="line">            .execute();</span><br><span class="line">            <span class="keyword">return</span> &#123; message: <span class="string">'删除成功'</span>, code: <span class="string">'01'</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 编辑相片记录内容</span></span><br><span class="line"><span class="comment">     * @param body</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> updatePhoto(body): <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> needUpdate = <span class="keyword">await</span> <span class="keyword">this</span>.photoRepository.findOne(body.id);</span><br><span class="line">        <span class="keyword">const</span> updated = <span class="built_in">Object</span>.assign(needUpdate, body);</span><br><span class="line">        <span class="keyword">await</span> <span class="keyword">this</span>.photoRepository.update(body.id,updated);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取相片列表</span></span><br><span class="line"><span class="comment">     * @param query</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> getPhotos(query): <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> qb = <span class="keyword">await</span> getRepository(Photo)</span><br><span class="line">            .createQueryBuilder(<span class="string">'p'</span>)</span><br><span class="line">            <span class="comment">// .select('p')</span></span><br><span class="line">            .select([<span class="string">'p.name'</span>,<span class="string">'p.url'</span>])</span><br><span class="line">            .skip((query.page - <span class="number">1</span>) * query.size)</span><br><span class="line">            .take(query.size)</span><br><span class="line">            .orderBy(&#123;</span><br><span class="line">                <span class="string">'p.create_time'</span>: <span class="string">'DESC'</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">        qb.where(<span class="string">'1 = 1'</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'name'</span> <span class="keyword">in</span> query) &#123;</span><br><span class="line">            qb.andWhere(<span class="string">'p.name = :name'</span>, &#123; name: query.name &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        qb.andWhere(<span class="string">'p.status != 1 '</span>);</span><br><span class="line">        <span class="keyword">const</span> list = <span class="keyword">await</span> qb.getMany();</span><br><span class="line">        <span class="keyword">const</span> total = <span class="keyword">await</span> qb.getCount();</span><br><span class="line">        <span class="keyword">return</span> &#123; list, total, message: <span class="string">'请求列表成功'</span>, code: <span class="string">'01'</span> &#125;;</span><br><span class="line">		</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在photoModule中</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; PhotoController &#125; <span class="keyword">from</span> <span class="string">'./photo.controller'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; PhotoService &#125; <span class="keyword">from</span> <span class="string">'./photo.service'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Photo &#125; <span class="keyword">from</span> <span class="string">'../entities/photo.entity'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TypeOrmModule &#125; <span class="keyword">from</span> <span class="string">'@nestjs/typeorm'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  imports: [TypeOrmModule.forFeature([Photo])], <span class="comment">// 使用forFeature()方法来定义应在当前范围中注册的存储库。</span></span><br><span class="line">  controllers: [PhotoController],</span><br><span class="line">  providers: [PhotoService]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> PhotoModule &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>到这里一个PhotoModule模块就完成啦</p>
<p>使用<code>npm run start</code> 启动项目通过postman传入参数请求到 <a href="http://localhost/photo" target="_blank" rel="noopener">http://localhost/photo</a> 就可以访问接口完成增删改查</p>
<h3 id="PhotoService中处理数据"><a href="#PhotoService中处理数据" class="headerlink" title="PhotoService中处理数据"></a>PhotoService中处理数据</h3><p>在PhotoService中处理数据时用到了typeorm的api</p>
<ul>
<li>Repository ，Query Builder<br>  通过<code>this.photoRepository</code> <code>getRepository().createQueryBuilder()</code> <code>getConnection().createQueryBuilder()</code> 都可以操作想要操作的存储库</li>
</ul>
<h3 id="未完待续"><a href="#未完待续" class="headerlink" title="未完待续.."></a>未完待续..</h3></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">扫呗</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://saobei.github.io/2019/12/10/nest-one/">https://saobei.github.io/2019/12/10/nest-one/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/blog/tags/Nest-js/">Nest.js</a><a class="post-meta__tags" href="/blog/tags/入门实战/">入门实战</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/blog/2019/12/11/node-schedule/"><i class="fa fa-chevron-left">  </i><span>node-schedule定时任务</span></a></div><div class="next-post pull-right"><a href="/blog/2019/12/10/js-abbreviation/"><span>js的一些常用简写操作</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="lv-container" data-id="city" data-uid="MTAyMC80NzI0MS8yMzc0MQ=="><script>(function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
})(document, 'script');</script></div></div></div><footer class="footer-bg" style="background-image: url(http://img.lcsw.cn/blog_banner.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2019 - 2020 By 扫呗</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/blog/js/utils.js?version=1.6.1"></script><script src="/blog/js/fancybox.js?version=1.6.1"></script><script src="/blog/js/sidebar.js?version=1.6.1"></script><script src="/blog/js/copy.js?version=1.6.1"></script><script src="/blog/js/fireworks.js?version=1.6.1"></script><script src="/blog/js/transition.js?version=1.6.1"></script><script src="/blog/js/scroll.js?version=1.6.1"></script><script src="/blog/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>